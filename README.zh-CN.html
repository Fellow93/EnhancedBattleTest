<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Enhanced Battle Test</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        
    </head>
    <body class="vscode-light">
        <h1 id="enhanced-battle-test">Enhanced Battle Test</h1>
<p>这是一个骑马与砍杀2：霸主的mod，可以做离线战斗测试。</p>
<h2 id="%e5%8a%9f%e8%83%bd">功能</h2>
<ul>
<li>
<p>Test Battle Mode：该模式中，你可以选择出生地点，所有部队都会一次性生成。</p>
</li>
<li>
<p>Custom Battle Mode：该模式采用砍二内建的生成部队方式：部队在场景中固定的地点生成。超出人数限制的部队会作为援军稍后加入战场。</p>
</li>
<li>
<p>地图选择：包括领军地图，冲突地图，死斗地图和部分攻城图。攻城图目前不稳定，容易崩溃。</p>
<p>Custom Battle Mode只包含领军地图，因为只有领军地图有该模式要求的军队出生点信息。</p>
<p>如果你想要体验更多地图，你可以自己编辑配置文件，详细内容见后文。</p>
</li>
<li>
<p>角色选择：你可以为每方队伍选择最多3种部队。你还可以选择和联机一致的perks。</p>
</li>
<li>
<p>保存配置：保存战斗配置的文件夹为&quot;(user directory)\Documents\Mount and Blade II Bannerlord\Configs\EnhancedBattleTest&quot;。</p>
<p>Test Battle Mode的配置保存在&quot;EnhancedTestBattleConfig.xml&quot;文件中，Custom Battle Mode的配置保存在&quot;EnhancedCustomBattleConfig.xml&quot;文件中。</p>
<p>比如你可以修改配置来添加更多地图，但如果你编辑有误，配置可能会被初始化为默认内容，或者游戏可能会崩溃，我对可能发生的情况不做任何保证。</p>
</li>
<li>
<p>切换玩家所在的队伍：你可以在控制玩家队伍的领队和控制敌军的领队之间切换，从而做到对两方部队轮流下令。</p>
</li>
<li>
<p>玩家死后可以控制其小兵。该小兵将会称为当前队伍的领队。</p>
</li>
<li>
<p>切换自由视角。</p>
</li>
<li>
<p>不死模式：开启后任何单位都不会掉血和死亡。</p>
</li>
<li>
<p>调整战斗AI：你可以将战斗ai在0-100间调整。</p>
</li>
<li>
<p>自定义玩家角色，详细内容如下。</p>
</li>
</ul>
<h2 id="%e5%a6%82%e4%bd%95%e5%ae%89%e8%a3%85">如何安装</h2>
<ol>
<li>
<p>复制<code>bin</code>和<code>Modules</code>两个文件夹到砍二的安装目录下（例如<code>C:\Program Files\Steam\steamapps\common\Mount &amp; Blade II Bannerlord - Beta</code>)。</p>
</li>
<li>
<p>游戏更新后如果mod出现问题，请尝试重装mod。若得不到解决，可以联系我并/或等待mod更新。</p>
</li>
</ol>
<h2 id="%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8">如何使用</h2>
<ul>
<li>
<p>当前联机测试中，官方的加载器禁用了单机模式，所以需要通过点击砍二安装目录下，<code>bin\Win64_Shipping_Client</code>中的<code>EnhancedBattleTest.bat</code>来启动。</p>
</li>
<li>
<p>配置界面介绍：</p>
<ul>
<li>
<p>最上方的左右箭头用于切换地图，中间的名称即为地图名称。</p>
</li>
<li>
<p>Soldiers per Row: 每行士兵数量。</p>
</li>
<li>
<p>Formation Position(x, y)：玩家队伍出生位置。</p>
</li>
<li>
<p>Formation Direction(x, y)：玩家队伍朝向。</p>
</li>
<li>
<p>Sky Brightness：天空亮度。-1表示不做修改，采用场景的默认设置。</p>
</li>
<li>
<p>Rain Density：下雨程度。-1表示不做修改，采用场景的默认设置。</p>
</li>
<li>
<p>Player Character：选择玩家控制的角色。</p>
<ul>
<li>
<p>点击右侧按钮后，进入角色选择页面。角色选择页面从左至右依次为：</p>
<ul>
<li>
<p>联机阵营。</p>
</li>
<li>
<p>士兵类型。Infantry为步兵，Ranged为射手，Cavalry为骑兵，HorseArcher为骑射手。</p>
</li>
<li>
<p>兵种名称。</p>
</li>
<li>
<p>兵种的第一个可选装备。</p>
</li>
<li>
<p>兵种的第二个可选装备。</p>
</li>
</ul>
</li>
<li>
<p>选择完成后，点击界面下方的done确认。</p>
</li>
</ul>
</li>
<li>
<p>Spawn Player：开局是否生成玩家角色。若不生成玩家角色，玩家仍可按F键控制下属士兵。</p>
</li>
<li>
<p>Player Troop 1/2/3：玩家的一至三号部队的角色。</p>
</li>
<li>
<p>Player Troop 1/2/3 Count：玩家的一至三号部队的人数。</p>
</li>
<li>
<p>Enemy Troop 1/2/3：敌军的一至三号部队的角色。</p>
</li>
<li>
<p>Enemy Troop 1/2/3 Count：敌军的一至三号部队的人数。</p>
</li>
<li>
<p>Enemy Commander：敌军将领的角色。</p>
</li>
<li>
<p>Spawn Enemy Commaner：是否生成敌军将领。</p>
</li>
<li>
<p>Distance：敌军部队和己方部队的距离。</p>
</li>
<li>
<p>Enemy Charge：敌军是否开局冲锋。</p>
</li>
<li>
<p>Disable Dying：是否禁用死亡。若是则所有角色不掉血。</p>
</li>
<li>
<p>Change Combat AI：是否改变战斗AI。若是则右侧的数值对所有单位生效，若否则所有单位的战斗AI为各自默认的设置。</p>
</li>
<li>
<p>Comabt AI(0-100)：要改变的战斗AI的数值，只有左侧的Change Combat AI选中才生效。有效范围在0-100。</p>
</li>
<li>
<p>Save And Start：保存配置并开始战斗。</p>
</li>
<li>
<p>Save：保存配置。</p>
</li>
<li>
<p>Load Config：从文件中加载配置。</p>
</li>
<li>
<p>Exit：退出，返回到标题画面。</p>
</li>
</ul>
</li>
<li>
<p>局内操作：</p>
<ul>
<li>
<p>按住<code>TAB</code>键来退出战斗。</p>
</li>
<li>
<p>按小键盘5键来切换队伍。</p>
</li>
<li>
<p>按小键盘6键来切换自由视角。</p>
</li>
<li>
<p>按<code>F</code>键或小键盘6键来在玩家死后控制其小兵。</p>
</li>
<li>
<p>按小键盘7键来切换不死模式。</p>
</li>
<li>
<p>按<code>L</code>键在自由视角下让玩家瞬移到镜头位置。</p>
</li>
</ul>
</li>
</ul>
<h2 id="%e5%a6%82%e4%bd%95%e8%87%aa%e5%ae%9a%e4%b9%89%e8%a7%92%e8%89%b2">如何自定义角色</h2>
<ul>
<li>
<p>你可以通过修改<code>Modules\EnhancedBattleTest\ModuleData\mpcharacters.xml</code>文件中，id为<code>player_character_1</code>，<code>player_character_2</code>和<code>player_character_3</code>的xml元素来自定义角色。</p>
</li>
<li>
<p>这个角色在<code>Modules\EnhancedBattleTest\ModuleData\mpclassdivisions.xml</code>中被引用，该文件定义了角色的护甲、移速和其它属性。</p>
</li>
<li>
<p><strong>然而</strong>，自从砍二b0.8.0版本开始（也许更早），将第三方mod中的<code>mpclassdivisions.xml</code>和<code>Native</code>中的<code>mpclassdivisions.xml</code>合并，并解析读取，实现得<strong>不正确</strong>：</p>
<p>xml元素间的空格未被忽略，游戏会因此崩溃。</p>
<p>这是砍二自身的bug，临时的解决方案是移除<code>Native</code>和本mod中的两个<code>mpclassdivisions.xml</code>文件里的xml元素间的所有换行和空格。</p>
<p>我已经帮你把这些做好了。所以如果你不修改这两个文件，你不需要关心这些。</p>
<p>如果你需要修改这两个文件中的任何一个，记得修改完毕后将其中xml元素间的所有换行和空格删除。</p>
<p>我用的是vscode的xml插件来自动删除空格。</p>
</li>
<li>
<p>因此如果你修改了其中的文件，或者游戏更新了（从而更新了Native中的<code>mpclassdivisions.xml</code>），若mod不能启动了，请尝试重装mod。</p>
<p>若重装不起作用，你可以尝试在<code>Modules\EnhancedBattleTest\SubModule.xml</code>文件中移除下面的内容：</p>
<pre><code><code><div>&lt;XmlNode&gt;
  &lt;XmlName id=&quot;MPClassDivisions&quot; path=&quot;mpclassdivisions&quot;/&gt;
&lt;/XmlNode&gt;
</div></code></code></pre>
<p>这样，游戏就应当不会再加载本mod中的<code>mpclassdivisions.xml</code>文件，也就不会将它和<code>Native</code>的对应文件合并，从而不可能再触发这个bug。</p>
<p>但这样做会导致无法自定义角色。</p>
</li>
<li>
<p>别怪我，请怪TaleWorlds写的代码(bug)。</p>
</li>
<li>
<p>希望这个bug早日被TaleWorlds修复。</p>
</li>
</ul>
<h2 id="%e4%bb%8e%e6%ba%90%e4%bb%a3%e7%a0%81%e6%9e%84%e5%bb%ba">从源代码构建</h2>
<p>源代码位于<code>source</code>文件夹下，在<a href="https://gitlab.com/lzh_mb_mod/enhancedbattletest">https://gitlab.com/lzh_mb_mod/enhancedbattletest</a> 中也可以获得源代码。</p>
<ol>
<li>
<p><a href="http://xn--49sq66h.NET">安装.NET</a> core sdk。</p>
</li>
<li>
<p>将<code>EnhancedBattleTest.csproj</code>中第6行的<code>Mb2Bin</code>属性修改为你的砍二安装位置。</p>
</li>
<li>
<p>打开一个终端shell(powershell或者cmd)，运行<code>dotnet msbuild -t:install</code>。这一步会构建<code>EnhancedBattleTest.dll</code>并将它复制到<code>bin\Win64_Shipping_Client</code>中。</p>
</li>
</ol>
<h2 id="%e8%a7%a3%e5%86%b3%e9%97%ae%e9%a2%98">解决问题</h2>
<ul>
<li>
<p>若遇到无法进入mod的情况，首先请在steam中校验文件完整性，之后再<strong>重新安装</strong>mod。</p>
<ul>
<li>注意每次游戏更新后（尤其是校验文件完整性之后的游戏更新后），若你想启动mod，你都应当先重新安装mod。</li>
</ul>
</li>
<li>
<p>若提示&quot;Unable to initialize Steam API&quot;:</p>
<ul>
<li>请先启动Steam，并确保砍二在你登录的Steam账号的库中.</li>
</ul>
</li>
<li>
<p>若在没有进入主菜单的情况下崩溃：</p>
<ul>
<li>
<p>mod很可能没有正确安装，请重新安装mod。若没用：</p>
</li>
<li>
<p>尝试将<code>EnhancedBattleTest.bat</code>中的<code>ManagedStarter.exe</code>替换为<code>NativeStarter.exe</code>。</p>
<p>这个方法已知对一部分无法启动mod的情况有用。</p>
</li>
</ul>
</li>
<li>
<p>如果在点击主菜单中的按钮时崩溃：</p>
<ul>
<li>重装mod。请阅读<code>如何自定义角色</code>小节以了解原因。</li>
</ul>
</li>
<li>
<p>如果在战斗配置界面中，选择数字时崩溃：</p>
<ul>
<li>这是由砍二的bug导致。你能做的是避免触发这个bug。</li>
</ul>
</li>
<li>
<p>若除攻城图之外的战斗中mod崩溃</p>
<ul>
<li>请把崩溃报告打包并通过下面的邮箱发给我。（崩溃报告位于<code>bin\Win64_Shipping_Client\</code>中，以崩溃时间为文件夹的名称）</li>
</ul>
</li>
</ul>
<h2 id="%e8%81%94%e7%b3%bb%e6%88%91">联系我</h2>
<ul>
<li>
<p>请发邮件到：lizhenhuan1019@qq.com</p>
</li>
<li>
<p>这个mod起源于Modbed做的&quot;Battle Test&quot;。</p>
<p>联系他的方法：</p>
<p>TaleWorlds论坛：modbed</p>
<p>Youtube：modbed</p>
<p>bilibili：modbed帅</p>
<p>website：<a href="http://modbed.cn">modbed.cn</a></p>
</li>
</ul>

    </body>
    </html>