<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Enhanced Battle Test</title>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
        
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        <style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        
        
    </head>
    <body class="vscode-light">
        <h1 id="enhanced-battle-test">Enhanced Battle Test</h1>
<p>A mod for Mount&amp;Blade Bannerlord that can test battle locally.</p>
<h2 id="features">Features</h2>
<ul>
<li>
<p>Test Battle Mode: You can choose where to spawn troops and they will be all spawned instantly.</p>
</li>
<li>
<p>Custom Battle Mode: Use built-in mechanism to spawn troops. Troops that exceeds the battle size limit will be spawned later.</p>
</li>
<li>
<p>Map selection. Including sergeant maps, skirmish maps, tdm maps and some siege maps.</p>
<p>Siege maps may crash.</p>
<p>Custom battle mode contains sergeant maps only, because only sergeant maps contains corrrect spawning positions that custom battle mode requires.</p>
<p>If you want more maps, you can edit the config file yourself, details below.</p>
</li>
<li>
<p>Character selection. You can specify at most three types of troops for each team.</p>
<p>Also you can select <strong>perks</strong> that is consistent with those in Multiplayer mode.</p>
</li>
<li>
<p>Configuration saving. The battle configuration is saved in &quot;(user directory)\Documents\Mount and Blade II Bannerlord\Configs\EnhancedBattleTest&quot;.</p>
<p>The configuration for Test Battle mode is saved in &quot;EnhancedTestBattleConfig.xml&quot; and that for Custom Battle mode is saved in &quot;EnhancedCustomBattleConfig.xml&quot;.</p>
<p>You can modify it to add more maps, but if you edit it incorrectly, the configuration will be reset to default, or the game may crash. I don't guarantee anything.</p>
</li>
<li>
<p>Switching player's team. You can switch between player agent and the enemy commander to control their troops respectively.</p>
</li>
<li>
<p>Controlling your bots after dead.</p>
</li>
<li>
<p>Switching free camera.</p>
</li>
<li>
<p>Undead mode. Any agent will not die after switched on.</p>
</li>
<li>
<p>Adjusting combat AI between 0 and 100.</p>
</li>
<li>
<p>Customizing player characters, details below.</p>
</li>
</ul>
<h2 id="how-to-install">How to install</h2>
<ol>
<li>
<p>Copy <code>bin</code> and <code>Modules</code> into Bannerlord installation folder(For example <code>C:\Program Files\Steam\steamapps\common\Mount &amp; Blade II Bannerlord - Beta</code>).</p>
</li>
<li>
<p>Remember to reinstall the mod after game updating. This may solve some problems.</p>
</li>
</ol>
<h2 id="how-to-use">How to use</h2>
<ul>
<li>
<p>Start the mod by clicking <code>EnhancedBattleTest.bat</code> in <code>bin\Win64_Shipping_Client</code> that you have copied into Bannerlord installation folder.</p>
</li>
<li>
<p>You can select troops for each side of teams.</p>
</li>
<li>
<p>Press and hold <code>TAB</code> key for a while to exit the battle scene.</p>
</li>
<li>
<p>Press <code>numpad5</code> key to switch your team.</p>
</li>
<li>
<p>Press <code>numpad6</code> key to switch between free camera and main agent camera.</p>
</li>
<li>
<p>Press <code>f</code> key or <code>numpad6</code> key to control one of your troops after you being killed.</p>
</li>
<li>
<p>Press <code>numpad7</code> to disable dying.</p>
</li>
<li>
<p>Press <code>L</code> key to teleport player when in free camera mode.</p>
</li>
</ul>
<h2 id="how-to-add-more-maps">How to add more maps</h2>
<ul>
<li>
<p>You can go to <code>Modules\Native\SceneObj</code> to find available maps.</p>
</li>
<li>
<p>To add more maps, you need to edit the configuartion file(in folder &quot;(user directory)\Documents\Mount and Blade II Bannerlord\Configs\EnhancedBattleTest&quot;).</p>
</li>
<li>
<p>The maps available in mod are under the xml element <code>sceneList</code>.</p>
<p>The element <code>SceneInfo</code> represents a map and related config.</p>
<p>So you need to add a <code>SceneInfo</code> element as a child of <code>sceneList</code>, just like the other maps.</p>
<p>For example you can copy the text between <code>&lt;SceneInfo&gt;</code> and <code>&lt;/SceneInfo&gt;</code>, then replace the text between <code>&lt;name&gt;</code> and <code>&lt;/name&gt;</code> with the folder name of the map you want to add.</p>
<p>The other config like formation positions can be configured in the game.</p>
</li>
</ul>
<h2 id="how-to-customize-characters">How to customize characters</h2>
<ul>
<li>
<p>You can customize your characters by modifying the xml elements with id <code>player_character_1</code>, <code>player_character_2</code> and <code>player_character_3</code> in <code>Modules\EnhancedBattleTest\ModuleData\mpcharacters.xml</code>.</p>
</li>
<li>
<p>These characters are referred in another file <code>Modules\EnhancedBattleTest\ModuleData\mpclassdivisions.xml</code>, in which armors, movement speed, perks and other properties of the character are defined.</p>
</li>
<li>
<p><strong>However</strong>, since Bannerlord b0.8.0(maybe since earlier version, I don't know), merging those two <code>mpclassdivisions.xml</code> files (one in <code>native</code> and one in this mod), and parsing them is <strong>NOT</strong> correctly implemented: the spaces between xml elements are not ignored, and the game will crash.</p>
<p>This is a bug in Bannerlord, and the work-around is to remove all the spaces between xml elements in both files.</p>
<p>I have done this for you. So you don't need to worry about it if you don't modify those two <code>mpclassdivisions.xml</code> files.</p>
<p>If you need to modify any of those two files, please remember to remove all the spaces between the xml elements just like I do.</p>
<p>I use vscode with xml extension to remove spaces automatically.</p>
</li>
<li>
<p>If you modified those files or the game updated(so <code>mpclassdivisions.xml</code> in Native may be updated), and the mod could not start, try to reinstall the mod.</p>
<p>If it does not work, then try to remove the following content in <code>Modules\EnhancedBattleTest\SubModule.xml</code>:</p>
<pre><code><code><div>&lt;XmlNode&gt;
  	&lt;XmlName id=&quot;MPClassDivisions&quot; path=&quot;mpclassdivisions&quot;/&gt;
  &lt;/XmlNode&gt;
</div></code></code></pre>
<p>This should make the game not to load <code>mpclassdivisions.xml</code> in this mod anymore, and do not merge it with the one in <code>native</code>. So it shound be impossible to trigger the bug mentioned above. However, the characters defined in <code>mpcharacters.xml</code> can no longer be spawned in the game.</p>
</li>
<li>
<p>Don't blame me, blame the code that TaleWorlds wrote.</p>
</li>
<li>
<p>Hope to see this bug fixed soon.</p>
</li>
</ul>
<h2 id="build-from-source">Build from source</h2>
<p>The source code is located in the <code>source</code> folder or available at <a href="https://gitlab.com/lzh_mb_mod/enhancedbattletest">https://gitlab.com/lzh_mb_mod/enhancedbattletest</a>.</p>
<ol>
<li>
<p>install .net core sdk</p>
</li>
<li>
<p>modify 6th line of <code>EnhancedBattleTest.csproj</code>, change <code>Mb2Bin</code> property to your bannerlord installation location</p>
</li>
<li>
<p>open a termial (powershell or cmd), run <code>dotnet msbuild -t:install</code>. This step will build <code>EnhancedBattleTest.dll</code> and copy it to <code>bin\Win64_Shipping_Client</code></p>
</li>
</ol>
<h2 id="troubleshoot">Troubleshoot</h2>
<ul>
<li>
<p>First of all, please try checking file integrity from Steam and then <strong>reinstall</strong> the mod.</p>
<ul>
<li>Note that you should reinstall the mod everytime after game update (especially the update after checking file integrity) if you want to launch the mod.</li>
</ul>
</li>
<li>
<p>If the mod crashed without entering Main menu:</p>
<ul>
<li>
<p>Reinstall the mod. if not working:</p>
</li>
<li>
<p>Try to replace <code>ManagedStarter.exe</code> with <code>NativeStarter.exe</code> in <code>EnhancedBattleTest.bat</code>.</p>
<p>This works for some people.</p>
</li>
</ul>
</li>
<li>
<p>If the mod crashed when clicking buttons in main menu:</p>
<ul>
<li>Reinstall the mod. See <code>How to customize characters</code> section above for reasons.</li>
</ul>
</li>
<li>
<p>If the mod crashed when selecting numbers in battle config UI:</p>
<ul>
<li>This is caused by bugs in Bannerlord. Maybe you can avoid to trigger this bug.</li>
</ul>
</li>
<li>
<p>If the mod crashed in battle (except in siege map):</p>
<ul>
<li>Please send the crash report to me via email below.</li>
</ul>
</li>
</ul>
<h2 id="contact-with-me">Contact with me</h2>
<ul>
<li>
<p>Please mail to: <a href="mailto:lizhenhuan1019@qq.com">lizhenhuan1019@qq.com</a></p>
</li>
<li>
<p>This mod is originated from mod &quot;Battle Test&quot; written by &quot;Modbed&quot;, who does not maintain &quot;Battle Test&quot; anymore.</p>
<p>Way to contact him:</p>
<p>TaleWorlds forum: modbed</p>
<p>youtube: modbed</p>
<p>bilibili: modbedå¸…</p>
<p>website: <a href="http://modbed.cn">modbed.cn</a></p>
</li>
</ul>

    </body>
    </html>